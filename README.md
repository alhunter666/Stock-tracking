ğŸ’° ä¸‰æ¡¶æŠ•èµ„ç»„åˆä»ªè¡¨æ¿ (V2.2 - Google Sheets ç‰ˆ)

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Streamlit æ„å»ºçš„ä¸ªäººæŠ•èµ„ä»ªè¡¨æ¿ï¼Œç”¨äºè·Ÿè¸ªæ‚¨çš„â€œä¸‰æ¡¶â€æŠ•èµ„ç­–ç•¥ã€‚

æ­¤ç‰ˆæœ¬ (V2.2) å…·æœ‰æŒä¹…åŒ–å­˜å‚¨åŠŸèƒ½ã€‚æ‚¨çš„æ‰€æœ‰æŒä»“æ•°æ®éƒ½å°†å®‰å…¨åœ°å­˜å‚¨åœ¨æ‚¨è‡ªå·±çš„ Google Sheet ä¸­ï¼Œè€Œä¸æ˜¯åœ¨æµè§ˆå™¨ä¼šè¯ä¸­ä¸¢å¤±ã€‚

ğŸš€ åŠŸèƒ½

æŒä¹…åŒ–å­˜å‚¨: æ•°æ®ä¿å­˜åœ¨æ‚¨ç§æœ‰çš„ Google Sheet ä¸­ã€‚

å‡†ç¡®çš„å¸‚å€¼: è‡ªåŠ¨è·å–è‚¡ç¥¨/ETFä»·æ ¼ï¼Œå¹¶å…è®¸æ‚¨æ‰‹åŠ¨è¾“å…¥æœŸæƒå¸‚å€¼ä»¥è·å¾—100%å‡†ç¡®çš„ç›ˆäºã€‚

æ¡¶2ç­–ç•¥è·Ÿè¸ª: ä¸“ä¸ºæœŸæƒæ”¶å…¥ç­–ç•¥è®¾è®¡ï¼Œå¯è·Ÿè¸ª status (Open/Closed), margin (ä¿è¯é‡‘), premium (æƒåˆ©é‡‘), cost to close (å¹³ä»“æˆæœ¬), å’Œ DTE (å‰©ä½™å¤©æ•°)ã€‚

äº¤æ˜“æ—¥å¿—: "äº¤æ˜“æ—¥å¿— & ç¼–è¾‘" é€‰é¡¹å¡å¯ä½œä¸ºæ‚¨çš„æ°¸ä¹…äº¤æ˜“è®°å½•ï¼Œç”¨äºå¤ç›˜å’Œè®°å½•å¿ƒå¾— (notes åˆ—)ã€‚

åŠ¨æ€ä»ªè¡¨æ¿: "ä»ªè¡¨æ¿" é€‰é¡¹å¡åªæ˜¾ç¤ºæ‚¨å½“å‰çš„æŒä»“å¿«ç…§å’Œå…³é”®æŒ‡æ ‡ã€‚

ğŸ› ï¸ é¦–æ¬¡è®¾ç½®æŒ‡å— (å¿…è¯»)

æ‚¨éœ€è¦æ‰§è¡Œä¸€æ¬¡æ€§è®¾ç½®ï¼Œä»¥æˆæƒ Streamlit (æ— è®ºæ˜¯æœ¬åœ°è¿˜æ˜¯äº‘ç«¯) è¯»å–æ‚¨çš„ Google Sheetã€‚è¿™å¤§çº¦éœ€è¦ 5-10 åˆ†é’Ÿã€‚

ç¬¬1æ­¥ï¼šåˆ›å»ºæ‚¨çš„ Google Sheet

è®¿é—® sheets.new åˆ›å»ºä¸€ä¸ªæ–°çš„ Google Sheetã€‚

å°†å…¶å‘½åä¸ºæ‚¨å–œæ¬¢çš„åå­— (ä¾‹å¦‚ï¼š"æˆ‘çš„æŠ•èµ„ç»„åˆ")ã€‚

åœ¨åº•éƒ¨åˆ›å»ºä¸‰ä¸ªå·¥ä½œè¡¨ (Tabs)ï¼Œå¹¶ç²¾ç¡®å‘½åä¸ºï¼šæ¡¶1, æ¡¶2, æ¡¶3ã€‚

è®¾ç½® æ¡¶1 å’Œ æ¡¶3 çš„è¡¨å¤´ (ç¬¬1è¡Œ):

åœ¨ æ¡¶1 çš„ A1:F1ï¼Œç²¾ç¡®å¡«å…¥ä»¥ä¸‹è¡¨å¤´ï¼š
ticker | type | quantity | total_cost | notes | manual_market_value

åœ¨ æ¡¶3 çš„ A1:F1ï¼Œç²¾ç¡®å¡«å…¥ä»¥ä¸‹è¡¨å¤´ï¼š
ticker | type | quantity | total_cost | notes | manual_market_value

è®¾ç½® æ¡¶2 çš„è¡¨å¤´ (ç¬¬1è¡Œ):

åœ¨ æ¡¶2 çš„ A1:H1ï¼Œç²¾ç¡®å¡«å…¥ä»¥ä¸‹è¡¨å¤´ (å…±8åˆ—)ï¼š
status | strategy | ticker | expiration_date | margin_used | premium_received | cost_to_close | notes

æ‚¨å¯ä»¥ç°åœ¨å°±å¡«å…¥å‡ è¡Œæ•°æ® (ä¾‹å¦‚æ‚¨çš„ AVGO æŒä»“)ï¼Œæˆ–è€…ç•™ç©ºã€‚

ç¬¬2æ­¥ï¼šåˆ›å»º Google Service Account (æœåŠ¡å¸æˆ·)

è¿™æ˜¯ä¸ºäº†è·å–ä¸€ä¸ªâ€œæœºå™¨äººå¸æˆ·â€çš„å¯†é’¥ï¼Œä»¥ä¾¿ Streamlit å¯ä»¥ä»£è¡¨æ‚¨ç¼–è¾‘è¡¨æ ¼ã€‚

è®¿é—® Google Cloud Consoleã€‚

å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œè¯·åŒæ„æœåŠ¡æ¡æ¬¾ã€‚

åœ¨é¡¶éƒ¨æœç´¢æ æˆ– "Select a project" (é€‰æ‹©é¡¹ç›®) ä¸‹æ‹‰èœå•ä¸­ï¼Œç‚¹å‡» "New Project" (æ–°å»ºé¡¹ç›®)ã€‚

ç»™é¡¹ç›®èµ·ä¸€ä¸ªåå­— (ä¾‹å¦‚ï¼š"Streamlit Dashboard")ï¼Œç„¶åç‚¹å‡» "Create" (åˆ›å»º)ã€‚

å¯ç”¨ APIs:

ç­‰å¾…é¡¹ç›®åˆ›å»ºå®Œæˆ (å³ä¸Šè§’ä¼šæœ‰é€šçŸ¥)ã€‚ç¡®ä¿æ‚¨çš„æ–°é¡¹ç›®å·²è¢«é€‰ä¸­ã€‚

åœ¨é¡¶éƒ¨æœç´¢æ ä¸­ï¼Œæœç´¢ "Google Drive API"ï¼Œå¹¶ç‚¹å‡»è¿›å…¥ã€‚ç‚¹å‡» "Enable" (å¯ç”¨)ã€‚

å†æ¬¡æœç´¢ "Google Sheets API"ï¼Œå¹¶ç‚¹å‡»è¿›å…¥ã€‚ç‚¹å‡» "Enable" (å¯ç”¨)ã€‚

åˆ›å»ºæœåŠ¡å¸æˆ·:

åœ¨é¡¶éƒ¨æœç´¢æ ä¸­ï¼Œæœç´¢ "Service Accounts" (æœåŠ¡å¸æˆ·)ï¼Œå¹¶ç‚¹å‡»è¿›å…¥ã€‚

ç‚¹å‡» "+ Create Service Account" (åˆ›å»ºæœåŠ¡å¸æˆ·)ã€‚

ç»™å®ƒä¸€ä¸ªåå­— (ä¾‹å¦‚ï¼š"sheets-editor")ï¼Œç„¶åç‚¹å‡» "Create and Continue" (åˆ›å»ºå¹¶ç»§ç»­)ã€‚

åœ¨ "Grant this service account access to project" (æˆäºˆæ­¤æœåŠ¡å¸æˆ·å¯¹é¡¹ç›®çš„è®¿é—®æƒé™) æ­¥éª¤ä¸­ï¼Œé€‰æ‹©è§’è‰² (Role) ä¸º "Editor" (ç¼–è¾‘è€…)ã€‚

ç‚¹å‡» "Continue" (ç»§ç»­)ï¼Œç„¶åç‚¹å‡» "Done" (å®Œæˆ)ã€‚

è·å– JSON å¯†é’¥:

æ‚¨ç°åœ¨ä¼šçœ‹åˆ°æ‚¨çš„æ–°æœåŠ¡å¸æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ (ä¾‹å¦‚ï¼šsheets-editor@your-project-id.iam.gserviceaccount.com)ã€‚

ç‚¹å‡»å®ƒã€‚

è½¬åˆ° "Keys" (å¯†é’¥) é€‰é¡¹å¡ã€‚

ç‚¹å‡» "Add Key" (æ·»åŠ å¯†é’¥) -> "Create new key" (åˆ›å»ºæ–°å¯†é’¥)ã€‚

é€‰æ‹© JSON æ ¼å¼ï¼Œç„¶åç‚¹å‡» "Create" (åˆ›å»º)ã€‚

ä¸€ä¸ª .json å¯†é’¥æ–‡ä»¶å°†è‡ªåŠ¨ä¸‹è½½åˆ°æ‚¨çš„è®¡ç®—æœºã€‚è¯·å¦¥å–„ä¿ç®¡æ­¤æ–‡ä»¶ï¼Œä¸è¦å…¬å¼€åˆ†äº«å®ƒã€‚

ç¬¬3æ­¥ï¼šå°†å¯†é’¥ (Key) æ·»åŠ åˆ° Streamlit Secrets

è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æ‚¨ä¹‹å‰é‡åˆ° "TOML" é”™è¯¯çš„åœ°æ–¹ã€‚

åœ¨æœ¬åœ°è¿è¡Œ:

åœ¨æ‚¨çš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º .streamlit çš„æ–‡ä»¶å¤¹ã€‚

åœ¨ .streamlit æ–‡ä»¶å¤¹å†…ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º secrets.toml çš„æ–‡ä»¶ã€‚

éƒ¨ç½²åˆ° Streamlit Cloud:

åœ¨æ‚¨çš„åº”ç”¨éƒ¨ç½²é¡µé¢ï¼Œç‚¹å‡» "Settings" (è®¾ç½®) -> "Secrets" (å¯†é’¥)ã€‚

æ‰“å¼€æ‚¨ä¸‹è½½çš„ .json å¯†é’¥æ–‡ä»¶ (ä¾‹å¦‚ç”¨è®°äº‹æœ¬æˆ–ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨)ã€‚

å¤åˆ¶ä¸‹é¢çš„æ¨¡æ¿ï¼Œå¹¶å°†å…¶ç²˜è´´åˆ°æ‚¨çš„ secrets.toml æ–‡ä»¶æˆ– Streamlit Cloud çš„ Secrets æ–‡æœ¬æ¡†ä¸­ï¼š

# è¿™æ˜¯æ­£ç¡®çš„ TOML æ ¼å¼
[gsheets]
type = "..."
project_id = "..."
private_key_id = "..."
private_key = "..."
token_uri = "..."
auth_uri = "..."
client_provider_x509_cert_url = "..."
client_id = "..."
client_email = "..."


é€ä¸ªå°† .json æ–‡ä»¶ä¸­çš„å€¼ï¼ˆåªå¤åˆ¶å¼•å·å†…çš„éƒ¨åˆ†ï¼‰ç²˜è´´åˆ° Secrets æ¨¡æ¿ä¸­ ... çš„ä½ç½®ï¼ˆç¡®ä¿ä¿ç•™æ¨¡æ¿ä¸­çš„åŒå¼•å· "ï¼‰ã€‚

ç¤ºä¾‹ï¼š

å¦‚æœæ‚¨çš„ .json æ–‡ä»¶æ˜¾ç¤º:
"project_id": "ibkr-dashboard-476718",

æ‚¨å¤åˆ¶ ibkr-dashboard-476718

æ‚¨ç²˜è´´åˆ° Secrets ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒ:
project_id = "ibkr-dashboard-476718"

æœ€é‡è¦çš„ï¼šprivate_key

æ‚¨çš„ .json æ–‡ä»¶æ˜¾ç¤º:
"private_key": "-----BEGIN PRIVATE KEY-----\nAAAA...\n...BBBB\n-----END PRIVATE KEY-----\n",

æ‚¨å¿…é¡»å¤åˆ¶å¼•å·å†…çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬ -----BEGIN...ï¼Œ\n å­—ç¬¦ï¼Œä»¥åŠ ...END PRIVATE KEY-----ï¼‰ã€‚

æ‚¨ç²˜è´´åˆ° Secrets ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒ:
private_key = "-----BEGIN PRIVATE KEY-----\nAAAA...\n...BBBB\n-----END PRIVATE KEY-----\n"

ç¬¬4æ­¥ï¼šåˆ†äº«æ‚¨çš„ Google Sheet

è¿™æ˜¯æœ€åä¸€æ­¥ã€‚

å›åˆ°æ‚¨åœ¨ç¬¬1æ­¥ä¸­åˆ›å»ºçš„ Google Sheetã€‚

ç‚¹å‡»å³ä¸Šè§’çš„ "Share" (åˆ†äº«) æŒ‰é’®ã€‚

æ‰¾åˆ°æ‚¨åœ¨ç¬¬2æ­¥ä¸­åˆ›å»ºçš„æœåŠ¡å¸æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ (å®ƒåœ¨æ‚¨çš„ .json æ–‡ä»¶ä¸­ï¼Œåä¸º client_emailï¼Œä¾‹å¦‚ï¼šsheets-editor@your-project-id.iam.gserviceaccount.com)ã€‚

å°†è¿™ä¸ªç”µå­é‚®ä»¶åœ°å€ç²˜è´´åˆ° "Share" æ¡†ä¸­ã€‚

ç¡®ä¿å®ƒè¢«èµ‹äºˆ "Editor" (ç¼–è¾‘è€…) æƒé™ã€‚

ç‚¹å‡» "Share" (åˆ†äº«)ã€‚

å…¨éƒ¨å®Œæˆï¼ ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œæˆ–é‡æ–°å¯åŠ¨æ‚¨çš„ Streamlit åº”ç”¨æ—¶ï¼Œapp.py ä¸­çš„ conn = st.connection("gsheets", ...) ä»£ç å°†ä½¿ç”¨æ‚¨çš„ Secretsï¼Œå®‰å…¨åœ°è¿æ¥åˆ°æ‚¨çš„ Google Sheet å¹¶è¯»å–æ•°æ®ã€‚
